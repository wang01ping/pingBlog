<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>虚拟dom的原理 | 网站标题</title>
    <meta name="description" content="打牢基础，方能以不变应万变">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.1de25b46.css" as="style"><link rel="preload" href="/assets/js/app.571835fb.js" as="script"><link rel="preload" href="/assets/js/2.032ef3b3.js" as="script"><link rel="preload" href="/assets/js/12.6d898484.js" as="script"><link rel="prefetch" href="/assets/js/10.a0abf90e.js"><link rel="prefetch" href="/assets/js/11.46652761.js"><link rel="prefetch" href="/assets/js/13.bd280f66.js"><link rel="prefetch" href="/assets/js/14.ce1a4751.js"><link rel="prefetch" href="/assets/js/3.a7c5b0d4.js"><link rel="prefetch" href="/assets/js/4.16bde8bc.js"><link rel="prefetch" href="/assets/js/5.3a47c97f.js"><link rel="prefetch" href="/assets/js/6.9ba05d7d.js"><link rel="prefetch" href="/assets/js/7.dc8b2967.js"><link rel="prefetch" href="/assets/js/8.3a9ec03d.js"><link rel="prefetch" href="/assets/js/9.9a03e3c3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1de25b46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">网站标题</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/algorithm/" class="nav-link">前端算法</a></div><div class="nav-item"><a href="http://obkoro1.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/OBKoro1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/OBKoro1/Brush_algorithm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/algorithm/" class="nav-link">前端算法</a></div><div class="nav-item"><a href="http://obkoro1.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/OBKoro1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/OBKoro1/Brush_algorithm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  算法仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端基础</span> <!----></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Html</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/javascript/index1.html" class="sidebar-link">/myBlog/javascript/index1.html</a></li><li><a href="/" class="sidebar-link">Home</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>模块化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/moudle/export.html" class="sidebar-link">导入导出在es6和node的区别</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/vue/vNode.html" class="active sidebar-link">虚拟dom的原理</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/" class="sidebar-link">Home</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/webpack/index1.html" class="sidebar-link">/myBlog/webpack/index1.html</a></li><li><a href="/" class="sidebar-link">Home</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="虚拟dom的原理"><a href="#虚拟dom的原理" aria-hidden="true" class="header-anchor">#</a> 虚拟dom的原理</h3> <div class="tip custom-block"><p class="custom-block-title">通俗讲法</p> <p>js对象模拟真实的dom，然后用虚拟dom的diff方法来最小化更新真实的DOM</p></div> <p>要了解snabbdom的话有必要先去github上先了解下snabbdom： https://github.com/snabbdom/snabbdom</p> <p>核心代码:
<img src="https://images2018.cnblogs.com/blog/1048550/201807/1048550-20180701161550123-1194170923.png" alt="核心代码"></p> <p>这里可以看到列出来的两个主要的核心函数，即h()函数和patch()函数，我们先来看下h()函数：</p> <p>h函数
<img src="https://images2018.cnblogs.com/blog/1048550/201807/1048550-20180701162713295-1547393320.png" alt="ss"></p> <h3 id="最终转化为了json对象的虚拟dom"><a href="#最终转化为了json对象的虚拟dom" aria-hidden="true" class="header-anchor">#</a> 最终转化为了json对象的虚拟dom</h3> <p>patch函数</p> <p>patch函数的执行分为两个阶段，两次传递的参数都是两个</p> <p>第一阶段为虚拟dom的第一次渲染，传递的两个参数分别是放真实DOM的container和生成的vnode，此时patch函数的作用是用来将初次生成的真实DOM结构挂载到指定的container上面。</p> <p>第二阶段传递的两个参数分别为vnode和newVnode，此时patch函数的作用是使用diff算法对比两个参数的差异，进而更新参数变化的DOM节点；</p> <p>可以发发现h函数和patch函数在cnabbdom中实现vdom到真实DOM的转化起到了至关重要的作用，那么还有一个很重要的环节，patch函数中是怎么样实现对比两个vnode从而实现对真实DOM的更新的呢，这里还要提一下snabbdom的另外一个核心算法，即diff算法。</p> <p>diff算法</p> <p>其实在我们日常开发中我们都在接触类似与diff算法的一些软件，比如svn可以看到当前代码和svn服务器上代码的不同之处，再如Beyond Compare这款软件也可以为我们指出两个对比文件的不同之处</p> <p>但是此处是如何实现对vnode的对比的呢？参考以下代码：</p> <blockquote><p>function updateChildren(vnode, newVnode) {      // 创建对比函数
var children = vnode.children || []<br>
var newChildren = newVnode.children || []</p></blockquote> <pre><code>children.forEach(function(childrenVnode, index) {
    var newChildVnode = newChildren[index]  // 首先拿到对应新的节点
    if (childrenVnode.tag === newChildVnode.tag) {    // 判断节点是否相同
        updateChilren(childrenVnode, newChildVnode)   // 如果相同执行递归，深度对比节点
    } else {
        repleaseNode(childrenVnode, newChildVnode)    // 如果不同则将旧的节点替换成新的节点
    }
})
</code></pre> <p>}</p> <p>function repleaseNode(vnode, newVnode) {    // 节点替换函数
var elem = vnode.elem
var newEle = createElement(newVnode)
}</p> <h3 id="推荐链接-virtual-dom-前世今生"><a href="#推荐链接-virtual-dom-前世今生" aria-hidden="true" class="header-anchor">#</a> 推荐链接 <a href="https://zhuanlan.zhihu.com/p/35876032" target="_blank" rel="noopener noreferrer">virtual Dom 前世今生<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></h3></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myBlog/moudle/export.html" class="prev">导入导出在es6和node的区别</a></span> <span class="next"><a href="/" class="router-link-active">Home</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.571835fb.js" defer></script><script src="/assets/js/2.032ef3b3.js" defer></script><script src="/assets/js/12.6d898484.js" defer></script>
  </body>
</html>
